<%- include("../../views/partials/user/header") %>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background-color: #f8f7f5;
    color: #1a1a1a;
    line-height: 1.6;
    font-weight: 300;
}

.breadcrumbs {
    padding: 20px 0;
    background-color: #f8f7f5;
    border-bottom: 1px solid #e5e0d5;
}

.breadcrumbs .container {
    display: flex;
    align-items: center;
}

.breadcrumb-list {
    display: flex;
    list-style: none;
    flex-wrap: wrap;
}

.breadcrumb-list li {
    display: flex;
    align-items: center;
    font-size: 0.9rem;
}

.breadcrumb-list li:not(:last-child)::after {
    content: "/";
    margin: 0 10px;
    color: #b8a484;
}

.breadcrumb-list a {
    color: #7d7d7d;
    text-decoration: none;
    transition: color 0.3s;
}

.breadcrumb-list a:hover {
    color: #b8a484;
}

.breadcrumb-list li:last-child {
    color: #1a1a1a;
    font-weight: 500;
}

.product-section {
    padding: 40px 0;
    position: relative;
}

.container {
    max-width: 1500px;
    margin: 0 auto;
    padding: 0 50px;
}

.product-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 80px;
}

/* Gallery */
.gallery {
    background-color: #ffffff;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.3s ease;
    position: relative;
}

.gallery:hover {
    box-shadow: 0 30px 60px -15px rgba(0, 0, 0, 0.15);
}

.main-image {
    position: relative;
    overflow: hidden;
}

/* Zoom feature */
.zoom-container {
    position: relative;
    cursor: crosshair;
}

.zoomed-image {
    position: absolute;
    top: 0;
    left: 110%;
    width: 300%;
    height: 300%;
    background-color: #ffffff;
    z-index: 100;
    overflow: hidden;
    display: none;
    box-shadow: 0 5px 25px rgba(0,0,0,0.15);
    border: 1px solid #e5e0d5;
}

.zoom-lens {
    position: absolute;
    border: 1px solid #b8a484;
    background-color: rgba(184, 164, 132, 0.1);
    width: 100px;
    height: 100px;
    display: none;
}

.zoom-icon {
    position: absolute;
    top: 20px;
    right: 20px;
    background-color: rgba(255, 255, 255, 0.9);
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 10;
}

.zoom-icon:hover {
    background-color: #1a1a1a;
    color: #ffffff;
}

.image-slider figure {
    display: none;
    opacity: 0;
    transition: opacity 0.5s ease;
}

.image-slider figure.active {
    display: block;
    opacity: 1;
}

.image-slider img {
    width: 100%;
    height: 700px;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.thumbnails {
    display: flex;
    gap: 20px;
    margin-top: 30px;
    margin-left: 95px;
    overflow-x: auto;
    scrollbar-width: none;
}

.thumbnails::-webkit-scrollbar {
    display: none;
}

.thumbnails div {
    width: 100px;
    height: 100px;
    border: 1px solid #e5e0d5;
    cursor: pointer;
    transition: all 0.3s ease;
    opacity: 0.7;
}

.thumbnails div.active {
    border-color: #1a1a1a;
    opacity: 1;
}

.thumbnails div:hover {
    opacity: 1;
    transform: translateY(-5px);
}

.thumbnails img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Product Info */
.product-info {
    padding: 20px 0;
}

.brand-name {
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 15px;
    font-weight: 600;
}

.product-title {
    font-size: 2.5rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 35px;
    font-weight: 300;
}

.rating {
    display: flex;
    align-items: center;
    margin-bottom: 30px;
}

.star-rating::before {
    content: "★★★★★";
    color: #e4e5e9;
    font-size: 18px;
}

.star-rating .filled {
    position: absolute;
    top: 143px;
    left: 992px;
    overflow: hidden;
    color: #b8a484;
    font-size: 18px;
}

.rating span {
    margin-left: 15px;
    font-size: 14px;
    color: #6c757d;
}

.price {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 40px;
}

.price .current {
    font-size: 2.2rem;
    font-weight: 400;
}

.price .old {
    font-size: 1.3rem;
    color: #8f8f8f;
    text-decoration: line-through;
}

.price .offer {
    font-size: 0.9rem;
    color: #b8a484;
    padding: 8px 15px;
    border: 1px solid #b8a484;
    transition: all 0.3s ease;
}

.price:hover .offer {
    background-color: #b8a484;
    color: #ffffff;
}

.description {
    color: #555;
    font-size: 1.05rem;
    margin-bottom: 40px;
    line-height: 1.9;
}

.features {
    list-style: none;
    margin-bottom: 40px;
}

.features li {
    padding-left: 35px;
    margin-bottom: 20px;
    font-size: 0.95rem;
    color: #555;
    position: relative;
}

.features li i {
    position: absolute;
    left: 0;
    top: 4px;
    color: #b8a484;
    font-size: 1.1rem;
}

.actions {
    display: flex;
    align-items: center;
    gap: 20px;
}

.quantity {
    display: flex;
    align-items: center;
    border: 1px solid #e5e0d5;
    width: 160px;
    height: 60px;
}

.quantity a {
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: #1a1a1a;
    transition: color 0.3s;
}

.quantity a:hover {
    color: #b8a484;
}

.quantity span {
    flex: 1;
    text-align: center;
    font-size: 1.1rem;
}

.add-to-cart {
    background-color: #1a1a1a;
    color: white;
    border: none;
    height: 60px;
    padding: 0 50px;
    text-transform: uppercase;
    letter-spacing: 2px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.add-to-cart:hover {
    background-color: #b8a484;
}

.wishlist {
    width: 60px;
    height: 60px;
    background-color: #ffffff;
    border: 1px solid #e5e0d5;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #1a1a1a;
    text-decoration: none;
    transition: all 0.3s ease;
}

.wishlist:hover i {
    color: #b8a484;
}

.meta {
    list-style: none;
    color: #7d7d7d;
    font-size: 0.85rem;
    margin-top: 40px;
}
.product-title {
    display: inline-block; 
    border-bottom: 2px solid #000;
    padding-bottom: 5px; 
}

.meta li {
    margin-bottom: 15px;
}

.meta li strong {
    width: 140px;
    color: #1a1a1a;
    font-weight: 500;
    text-transform: uppercase;
}

.meta a {
    color: #7d7d7d;
    text-decoration: none;
    transition: color 0.3s;
}

.meta a:hover {
    color: #b8a484;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .product-grid {
        gap: 60px;
    }
    .image-slider img {
        height: 600px;
    }
    .container {
        padding: 0 30px;
    }
    .zoomed-image {
        display: none !important;
    }
}

@media (max-width: 992px) {
    .product-grid {
        grid-template-columns: 1fr;
        gap: 50px;
    }
    .product-section {
        padding: 60px 0;
    }
    .container {
        padding: 0 25px;
    }
}
</style>

<div class="breadcrumbs">
    <div class="container">
        <ul class="breadcrumb-list">
            <li><a href="/">Home</a></li>
            <li><a href="/shop">Shop</a></li>
            <li><a href="/shop/<%= category.slug %>"><%= category.name %></a></li>
            <li><%= product.productName %></li>
        </ul>
    </div>
</div>

<section class="product-section">
    <div class="container">
        <div class="product-grid">
            <div class="gallery">
                <div class="main-image">
                    <div class="zoom-icon">
                        <i class="fas fa-search"></i>
                    </div>
                    <div class="image-slider">
                        <% if (product.productImage && Array.isArray(product.productImage)) { %>
                            <% product.productImage.forEach((img, index) => { %>
                                <figure class="<%= index === 0 ? 'active' : '' %>">
                                    <div class="zoom-container">
                                        <div class="zoom-lens"></div>
                                        <img src="<%= img.replace('_', '_/') %>" alt="Product Image">
                                        <div class="zoomed-image"></div>
                                    </div>
                                </figure>
                            <% }) %>
                        <% } else { %>
                            <figure class="active">
                                <div class="zoom-container">
                                    <div class="zoom-lens"></div>
                                    <img src="default.jpg" alt="Default Image">
                                    <div class="zoomed-image"></div>
                                </div>
                            </figure>
                        <% } %>
                    </div>
                </div>
                <div class="thumbnails">
                    <% if (product.productImage && Array.isArray(product.productImage)) { %>
                        <% product.productImage.forEach((img, index) => { %>
                            <div class="<%= index === 0 ? 'active' : '' %>">
                                <img src="<%= img.replace('_', '_/') %>" alt="Thumbnail">
                            </div>
                        <% }) %>
                    <% } %>
                </div>
            </div>
            <div class="product-info">
                <h1 class="product-title"><%= product.productName %></h1>
                <div class="rating">
                    <div class="star-rating">
                        <div class="filled" style="width: 90%;">★★★★★</div>
                    </div>
                    <span>(25 reviews)</span>
                </div>
                <div class="price">
                    <span class="current"><%= product.salePrice %></span>
                    <span class="old"><%= product.regularPrice %></span>
                    <span class="offer">
                        <% if (!totalOffer) { %>
                            No Offers
                        <% } else { %>
                            <%= totalOffer %>% Off
                        <% } %>
                    </span>
                </div>
                <p class="description"><%= product.description %></p>
                <ul class="features">
                    <li><i class="fas fa-crown"></i> 1 Year Brand Warranty</li>
                    <li><i class="fas fa-sync-alt"></i> 30 Day Return Policy</li>
                    <li><i class="fas fa-credit-card"></i> Cash on Delivery</li>
                </ul>
                <div class="actions">
                    <div class="quantity">
                        <a href="#" class="decrease"><i class="fas fa-minus"></i></a>
                        <span id="quantity">1</span>
                        <a href="#" class="increase"><i class="fas fa-plus"></i></a>
                    </div>
                    <button class="add-to-cart">Add to Cart</button>
                    <a href="#" class="wishlist"><i class="fas fa-heart"></i></a>
                </div>
                <ul class="meta">
                    <li>Stock Code: <a href="#">FWM15VKT</a></li>
                    <li>Tags: <a href="#"><%= category.name %></a></li>
                    <li>Availability: <span><%= quantity %> Items in Stock</span></li>
                </ul>
            </div>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Image Slider
        const slider = document.querySelector('.image-slider');
        const figures = slider.querySelectorAll('figure');
        const thumbnails = document.querySelectorAll('.thumbnails div');
        let current = 0;

        function showSlide(index) {
            figures[current].classList.remove('active');
            thumbnails[current].classList.remove('active');
            current = (index + figures.length) % figures.length;
            figures[current].classList.add('active');
            thumbnails[current].classList.add('active');
        }

        thumbnails.forEach((thumb, index) => {
            thumb.addEventListener('click', () => showSlide(index));
        });

        // Quantity Controls
        const qtyVal = document.getElementById('quantity');
        const decrease = document.querySelector('.decrease');
        const increase = document.querySelector('.increase');

        decrease.addEventListener('click', (e) => {
            e.preventDefault();
            let value = parseInt(qtyVal.textContent);
            if (value > 1) qtyVal.textContent = value - 1;
        });

        increase.addEventListener('click', (e) => {
            e.preventDefault();
            let value = parseInt(qtyVal.textContent);
            qtyVal.textContent = value + 1;
        });

        // Image Zoom Functionality
        const zoomContainers = document.querySelectorAll('.zoom-container');
        
        zoomContainers.forEach(container => {
            const img = container.querySelector('img');
            const lens = container.querySelector('.zoom-lens');
            const zoomedImage = container.querySelector('.zoomed-image');
            
            // Calculate zoom ratio
            function getZoomRatio() {
                return img.naturalWidth / img.width;
            }
            
            // Initialize zoom functionality
            function initZoom() {
                // Set background image for zoomed area
                zoomedImage.style.backgroundImage = `url('${img.src}')`;
                zoomedImage.style.backgroundSize = `${img.width * getZoomRatio()}px ${img.height * getZoomRatio()}px`;
                
                // Show lens and zoomed area on mouse enter
                container.addEventListener('mouseenter', function() {
                    lens.style.display = 'block';
                    zoomedImage.style.display = 'block';
                });
                
                // Hide lens and zoomed area on mouse leave
                container.addEventListener('mouseleave', function() {
                    lens.style.display = 'none';
                    zoomedImage.style.display = 'none';
                });
                
                // Move lens and update zoomed area on mouse move
                container.addEventListener('mousemove', function(e) {
                    // Get cursor position
                    let pos = getCursorPos(e);
                    
                    // Calculate position of lens
                    let x = pos.x - (lens.offsetWidth / 2);
                    let y = pos.y - (lens.offsetHeight / 2);
                    
                    // Prevent lens from moving outside image
                    if (x > img.width - lens.offsetWidth) {x = img.width - lens.offsetWidth;}
                    if (x < 0) {x = 0;}
                    if (y > img.height - lens.offsetHeight) {y = img.height - lens.offsetHeight;}
                    if (y < 0) {y = 0;}
                    
                    // Set lens position
                    lens.style.left = x + "px";
                    lens.style.top = y + "px";
                    
                    // Calculate and set background position for zoomed image
                    let ratio = getZoomRatio();
                    zoomedImage.style.backgroundPosition = `-${x * ratio}px -${y * ratio}px`;
                });
                
                // Get cursor position
                function getCursorPos(e) {
                    let rect = img.getBoundingClientRect();
                    let x = e.pageX - rect.left - window.pageXOffset;
                    let y = e.pageY - rect.top - window.pageYOffset;
                    return {x, y};
                }
            }
            
            // Initialize zoom once image is loaded
            if (img.complete) {
                initZoom();
            } else {
                img.addEventListener('load', initZoom);
            }
        });
        
        const zoomIcon = document.querySelector('.zoom-icon');
        const gallery = document.querySelector('.gallery');
        let isFullscreen = false;
        
        zoomIcon.addEventListener('click', () => {
            if (!isFullscreen) {
                gallery.style.position = 'fixed';
                gallery.style.top = '0';
                gallery.style.left = '0';
                gallery.style.width = '100vw';
                gallery.style.height = '100vh';
                gallery.style.zIndex = '9999';
                gallery.style.padding = '40px';
                gallery.style.backgroundColor = 'rgba(255, 255, 255, 0.95)';
                gallery.style.display = 'flex';
                gallery.style.flexDirection = 'column';
                gallery.style.justifyContent = 'center';
                zoomIcon.innerHTML = '<i class="fas fa-times"></i>';
                isFullscreen = true;
            } else {
                gallery.style.position = 'relative';
                gallery.style.top = 'auto';
                gallery.style.left = 'auto';
                gallery.style.width = 'auto';
                gallery.style.height = 'auto';
                gallery.style.zIndex = 'auto';
                gallery.style.padding = '0';
                gallery.style.backgroundColor = '#ffffff';
                gallery.style.display = 'block';
                zoomIcon.innerHTML = '<i class="fas fa-search"></i>';
                isFullscreen = false;
            }
        });
    });
</script>

<%- include("../../views/partials/user/footer") %>